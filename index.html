<!DOCTYPE html>
<meta charset="utf-8">
<title>Web Mapping Open Data - GeoRodeo 2016</title>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v1.0.0-rc.1/leaflet.css" />
<link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />
<script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>
<script src="http://cdn.leafletjs.com/leaflet/v1.0.0-rc.1/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/leaflet.esri/2.0.0-beta.8/esri-leaflet.js" type="text/javascript"></script>
<script src="./js/turf.count.min.js" type="text/javascript"></script>
<script src="https://d3js.org/d3.v4.0.0-alpha.40.min.js"></script>
  
<style>

    body {
        padding: 0;
        margin: 0;
    }
    
    #map {
        width: 100%;
        height: 200px;
        /* overridden with setSize() */
    }

</style>

<div id="map"></div>

<script>

    //  map data from City of Austin, Texas and the US Census Bureau 
    //  "District  == 10 || District == 17 || District == 21 || District == 25 || District == 27 || District == 31 || District == 35"
    var nice;

    function main(){
        
        var map = new L.Map("map", {center : [30.28, -97.735], zoom : 11, minZoom : 1, maxZoom : 20});      // make a map
        
        var Stamen_TonerLite = L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.{ext}', {
            attribution : 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
            subdomains : 'abcd',
            minZoom : 0,
            maxZoom : 20,
            ext : 'png'
        }).addTo(map);
        

        var districtStyle = {  //  style objects
            "color" : "white",
            "fillColor" : "black",
            "weight" : 2
        };



        d3.json("./data/atx_tracts_latino_wgs84.json", function(data) {

            nice = data;

        });


        var tx_tracts = new L.geoJson(false, {style : styleTracts});


        $.getJSON("./data/atx_tracts_latino_wgs84.json", function(tracts) {

            tx_tracts.addData(tracts)

            .addTo(map); 

        });


        var house_districts = new L.geoJson(false);


        $.getJSON("./data/tx_congress_planc235.json", function(districts) {

            house_districts.addData(districts)

            .addTo(map); 

        });


        var baseLayers = {
            "Stamen Toner (Lite)" : Stamen_TonerLite
        };

        var overlays = {
            "TX Tracts" : tx_tracts,
            "House Districts" : house_districts
        };  //  did not add travis_county due to some funky behavior w/ Esri feature layer

        var layerControl = L.control.layers(baseLayers, overlays)  //  Layer Control
        
            .addTo(map);     


        var blueRamp6 = ['#67001f','#b2182b','#d6604d','#f4a582','#fddbc7','#ffffff','#e0e0e0','#bababa','#878787','#4d4d4d','#1a1a1a']; //  source: colorbrewer2.org
        
        blueRamp6.reverse();

        var colorScale = d3.scaleQuantize().domain([0,.97]).range(blueRamp6);  //

        function styleTracts(feature) {
            return {
                fillColor : colorScale(feature.properties.pct_latino),
                weight : 0,
                opacity : 1,
                color : 'white',
                fillOpacity : 0.8
            };
        }
    
    }

    

    // map window sizing 
    window.addEventListener('resize', function(){
            var h = window.innerHeight; 
            document.getElementById('map').style.height = h + "px"
    }, true);
        
    window.onload = function() {
        setSize();
        main();
    };
    
    function setSize(){
        var w = window.innerWidth;
        var h = window.innerHeight;
        document.getElementById('map').style.height = h + "px";
    }
    
</script>

